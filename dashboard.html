async function loadRecentFlights() {
  const snapshot = await getDocs(collection(db, "flightLogs"));
  const list = document.getElementById("recentFlights");
  const now = Date.now();

  snapshot.forEach(doc => {
    const f = doc.data();
    const flightTime = f.timestamp?.toDate?.() || new Date(f.timestamp);
    const age = now - flightTime.getTime();

    if (age <= 24 * 60 * 60 * 1000) {
      const card = document.createElement("div");
      card.className = "flight-card";
      const nameToShow = f.displayName || f.username;

      card.innerHTML = `
        <h3>${f.airline} ${f.flightNumber}</h3>
        <p><strong>Pilot:</strong> ${nameToShow}</p>
        <p><strong>Aircraft:</strong> ${f.aircraft}</p>
        <p><strong>Route:</strong> ${f.departureICAO} âž¡ ${f.arrivalICAO}</p>
        <p><strong>Logged:</strong> ${flightTime.toLocaleString()}</p>
      `;
      list.appendChild(card);
    }
  });

  if (list.innerHTML === "") {
    list.innerHTML = "<p>No flights logged in the last 24 hours.</p>";
  }
}

async function loadPilots() {
  const snapshot = await getDocs(collection(db, "flightLogs"));
  const pilots = new Map();
  snapshot.forEach(doc => {
    const f = doc.data();
    if (f.username) {
      pilots.set(f.username, f.displayName || f.username);
    }
  });

  const list = document.getElementById("pilotsList");
  [...pilots.entries()].sort().forEach(([username, displayName]) => {
    const li = document.createElement("li");
    li.innerHTML = `<a href="pilot.html?name=${encodeURIComponent(username)}">${displayName}</a>`;
    list.appendChild(li);
  });
}
